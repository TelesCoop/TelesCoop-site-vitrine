---
interface Client {
  name: string;
  client: string;
  client_poste?: string;
  logo?: string;
  testimonial: string;
  borderColor: string;
}

interface Props {
  clients: Client[];
}

const { clients } = Astro.props;
---

<section class="px-4">
  <div class="container mx-auto">
    <div class="text-center mb-12">
      <span class="tag tag-purple tag-xl mb-6">Ce que nos clients disent de nous</span>
    </div>

    <div class="testimonials-wrapper">
      <div class="slider-container" id="testimonials-slider">
        {clients.map((client, index) => (
          <div class={`testimonial-card ${index % 2 === 0 ? 'rotate-left' : 'rotate-right'}`} data-index={index}>
            <div class="testimonial-number">
              {String(index + 1).padStart(2, '0')}
            </div>
            <div class="testimonial-content">
              {client.logo && (
                <img
                  src={client.logo}
                  alt={client.name}
                  class="h-12 object-contain self-start"
                  onerror="this.style.display='none'"
                />
              )}
              <p class="font-medium text-2xl leading-relaxed">
                {client.testimonial}
              </p>
              <div class="mt-auto">
                <div class="flex items-center gap-4 mb-2">
                  <p class="font-semibold text-black text-2xl">{client.client}{client.client_poste && `, ${client.client_poste}`}</p>

                </div>

                <p class="text-lg mt-1 font-bold">{client.name}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <div class="testimonials-nav">
        {clients.map((_, index) => (
          <button class="nav-dot" data-slide={index} aria-label={`Témoignage ${index + 1}`}>
            {String(index + 1).padStart(2, '0')}
          </button>
        ))}
      </div>
    </div>

    <div class="flex flex-col items-center gap-4 mt-12 text-center">
      <p class="text-2xl">
        Votre projet vous paraît cohérent avec nos valeurs ?
        <strong class="font-bold">Écrivez-nous !</strong>
      </p>
      <a
        href="mailto:contact@telescoop.fr"
        class="btn btn-lg"
      >
        Contactez-nous
      </a>
    </div>
  </div>
</section>

<script>
  const cards = document.querySelectorAll('.testimonial-card');
  const navDots = document.querySelectorAll('.nav-dot');
  let currentSlide = 0;

  function goToSlide(index: number) {
    currentSlide = index;

    cards.forEach((card, i) => {
      card.classList.remove('active', 'stack-1', 'stack-2');

      if (i === index) {
        card.classList.add('active');
      } else if (i === index + 1) {
        card.classList.add('stack-1');
      } else if (i === index + 2) {
        card.classList.add('stack-2');
      }
    });

    navDots.forEach((dot, i) => {
      if (i === index) {
        dot.classList.add('active');
      } else {
        dot.classList.remove('active');
      }
    });
  }

  navDots.forEach((dot, index) => {
    dot.addEventListener('click', () => goToSlide(index));
  });

  // Initialize first slide
  goToSlide(0);
</script>
