---
interface Props {
  project: {
    title: string;
    projectResume: string;
    categories?: string[];
  };
  categories?: Record<string, any>;
  index?: number;
}

const { project, categories, index = 0 } = Astro.props;

function slugify(text: string) {
  return text
    .toString()
    .toLowerCase()
    .trim()
    .replace(/\s+/g, '-')
    .replace(/[^\w\-]+/g, '')
    .replace(/\-\-+/g, '-');
}

function getCategoryColorClass(categoryName: string) {
  const category = categories?.[categoryName];
  return category?.colorClass || 'beige';
}

const cardCategories = project.categories?.map(cat => slugify(cat)).join(' ') || '';
const rotateClass = index % 2 === 0 ? 'rotate-left' : 'rotate-right';
---

<a
  href={`/projet/${slugify(project.title)}/`}
  class={`card project-card flex-col p-6 ${rotateClass}`}
  data-categories={cardCategories}
  data-title={project.title}
  data-description={project.projectResume}
>
  <div class="w-full Ajoflex justify-between items-start gap-4 mb-4">
    <h3 class="text-xl md:text-2xl uppercase font-sans font-bold flex-1">
      {project.title}
    </h3>
    {project.projectEnd && (
      <span class="text-black/60 text-lg font-semibold shrink-0">
        {project.projectEnd}
      </span>
    )}
  </div>

  {project.categories && project.categories.length > 0 && (
    <div class="flex flex-wrap gap-2 mb-4">
      {project.categories.map((cat) => (
        <span class="badge" data-color={getCategoryColorClass(cat)}>
          {categories?.[cat]?.name || cat}
        </span>
      ))}
    </div>
  )}

  <p class="mt-auto text-base md:text-lg">{project.projectResume}</p>
</a>
