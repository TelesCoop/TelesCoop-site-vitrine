---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import About from '../components/home/About.astro';
import Skills from '../components/home/Skills.astro';
import Extra from '../components/home/Extra.astro';
import Measures from '../components/home/Measures.astro';
import Clients from '../components/home/Clients.astro';
import { getEntry, getCollection } from 'astro:content';

const home = await getEntry('data', 'home');
const skills = await getEntry('data', 'skills');
const extra = await getEntry('data', 'extra');
const measures = await getEntry('data', 'measures');

const testimonialsCollection = await getCollection('testimonials', ({ data }) => !data.draft);
const testimonialsData = testimonialsCollection
  .sort((a, b) => a.data.order - b.data.order)
  .map(t => ({
    name: t.data.name,
    client: t.data.client,
    client_poste: t.data.client_poste,
    logo: t.data.logo,
    borderColor: t.data.borderColor,
    testimonial: t.body,
  }));

const homeData = home?.data || {};
const skillsData = skills?.data || [];
const extraData = extra?.data || [];
const measuresData = measures?.data || [];
---

<Layout title="Accueil">
  <Header slot="header" />

  <div>
    <!-- Hero Section -->
    <section class="min-h-[calc(100vh-80px)] flex flex-col items-center justify-center text-center relative px-4 gap-6" aria-label="Section d'accueil">

      <h1 class="text-5xl lg:text-7xl font-light leading-tight z-10 max-w-6xl">
        Coopérative de développement pour des
        <span class="inline-block bg-black text-beige px-3 py-1 mt-2">
          projets engagés
        </span>
      </h1>

      <p class="text-lg md:text-xl lg:text-2xl text-black z-10 max-w-2xl">
        {homeData.tagline}
      </p>
      <div class="z-10 mt-4">
        <a
          href="mailto:contact@telescoop.fr"
          class="btn btn-md md:btn-lg"
          aria-label="Contactez TelesCoop par email"
        >
          Contactez-nous
        </a>
      </div>
    </section>

    <!-- About Section -->
    <section class="bg-yellow py-16" aria-label="À propos de TelesCoop">
      <About />
    </section>

    <!-- Skills Section -->
    <section class="py-16" aria-label="Notre offre de services">
      <Skills skills={skillsData} />
    </section>

    <!-- Extra Section -->
    <section class="bg-green py-16" aria-label="Notre méthode">
      <Extra extra={extraData} />
    </section>

    <!-- Clients Section -->
    <section class="py-16" aria-label="Témoignages clients">
      <Clients clients={testimonialsData} />
    </section>

    <!-- Measures Section -->
    <section class="bg-yellow py-16" aria-label="Nos mesures d'impact">
      <Measures measures={measuresData} />
    </section>
  </div>

  <Footer slot="footer" />
</Layout>
